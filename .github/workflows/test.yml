name: Tests

on:
  push:
    branches:
    - main
  pull_request:

defaults:
  run:
    shell: bash

jobs:
  test:
    name: Test
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]
        version: [ 0.8.38 ]
    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup Calcit
      uses: ./
      with:
        version: ${{ matrix.version }}

    - name: Try Calcit
      run: |
        cr -e "range 20"

    - name: Clear bin
      run: |
        rm -rfv /home/runner/bin/

    - name: Setup Calcit skip cache
      uses: ./
      with:
        version: ${{ matrix.version }}
        skipCache: true

    - name: Try Calcit
      run: |
        cr -e "range 20"

    - name: Clear bin
      run: |
        rm -rfv /home/runner/bin/

    - name: Setup Calcit with cache
      uses: ./
      with:
        version: ${{ matrix.version }}
        skipCache: false

    - name: Capture Calcit
      run: |
        cr --help
        caps --help
        cr -e "range 100"
